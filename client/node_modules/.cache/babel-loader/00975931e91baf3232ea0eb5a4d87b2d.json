{"ast":null,"code":"const puppeteer = require('puppeteer');\n\nconst express = require('express');\n\nconst app = express();\napp.get('/data', async (req, res) => {\n  // scrapeMnData(req.query.url, res)\n  console.log(\"made it!\");\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.goto(req.query.url);\n  console.log(\"went to page\"); // const [mnCasesEl] = await page.$x('//*[@id=\"body\"]/ul[2]/li/text()')\n  // const mnCasesTxt = await mnCasesEl.getProperty('textContent');\n  // const mnCases = await mnCasesTxt.jsonValue();\n\n  const [mnCasesChartEl] = await page.$x('//*[@id=\"body\"]/img[1]');\n  const mnCasesChartTxt = await mnCasesChartEl.getProperty('alt');\n  const mnCasesChart = await mnCasesChartTxt.jsonValue(); // logCases(mnCases);\n\n  res.writeHead(200, {\n    'Content-Type': 'application/json',\n    'Content-Length': data.length\n  });\n  res.send(splitCases(mnCasesChart));\n  await browser.close();\n});\napp.listen(4000);\n\nasync function scrapeData(ilUrl, mnUrl) {// scrapeIlData(ilUrl)\n  // return scrapeMnData(mnUrl);\n}\n\nfunction buildDate() {\n  let today = new Date();\n  return String(today.getMonth() + 1) + '-' + String(today.getDate()) + '-' + String(today.getFullYear());\n}\n\nconst data = [{\n  name: 'Page A',\n  IL: 4000,\n  MN: 2400\n}, {\n  name: 'Page B',\n  IL: 3000,\n  MN: 1398\n}, {\n  name: 'Page C',\n  IL: 2000,\n  MN: 11800\n}, {\n  name: 'Page D',\n  IL: 2780,\n  MN: 3908\n}, {\n  name: 'Page E',\n  IL: 1890,\n  MN: 4800\n}, {\n  name: 'Page F',\n  IL: 2390,\n  MN: 3800\n}, {\n  name: 'Page G',\n  IL: 3490,\n  MN: 4300\n}];\n\nfunction logCases(cases) {\n  console.log(buildDate() + ': ' + cases);\n}\n\nasync function scrapeIlData(url) {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.goto(url);\n  const [ilCasesEl] = await page.$x('//*[@id=\"covid19positive\"]');\n  const ilCasesTxt = await ilCasesEl.getProperty('textContent');\n  const ilCases = await ilCasesTxt.jsonValue();\n  logCases(ilCases);\n  browser.close();\n}\n\nfunction splitCases(cases) {\n  const data = cases.split(\"\\n\");\n  const parsed = data.slice(1, data.length - 1);\n  parsed.forEach(getDayData);\n  return parsed;\n}\n\nfunction getDayData(dayString, index, arr) {\n  const day = dayString.replace(\"\\t\", \" \").split(\", \");\n  arr[index] = {\n    name: day[0],\n    MN_new: Number(day[1]),\n    MN_total: Number(day[2])\n  }; // dayString = dayString.replace(\"\\t\", \" \").split(\", \");\n  // console.log(dayString);\n  // return a;\n}\n\nasync function scrapeMnData(url, res) {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.goto(url);\n  const [mnCasesEl] = await page.$x('//*[@id=\"body\"]/ul[2]/li/text()');\n  const mnCasesTxt = await mnCasesEl.getProperty('textContent');\n  const mnCases = await mnCasesTxt.jsonValue();\n  const [mnCasesChartEl] = await page.$x('//*[@id=\"body\"]/img[1]');\n  const mnCasesChartTxt = await mnCasesChartEl.getProperty('alt');\n  const mnCasesChart = await mnCasesChartTxt.jsonValue();\n  logCases(mnCases);\n  res.writeHead(200, {\n    'Content-Type': 'application/json',\n    'Content-Length': data.length\n  });\n  res.end(splitCases(mnCasesChart));\n  await browser.close(); // return splitCases(mnCasesChart);\n} // scrapeData('https://covid19stats.live/coronavirus/statistics/usa')\n// scrapeData('https://www.amazon.com/Black-Swan-Improbable-Nicholas-Takeaways/dp/B01AIKQ5LY/ref=sr_1_8?dchild=1&keywords=The+Black+Swan&qid=1586028302&s=books&sr=1-8')\n// scrapeData('https://www.amazon.com/Original-Sliding-C-Slide-Privacy-Chromebooks/dp/B00HPC66U4/ref=redir_mobile_desktop?ie=UTF8&aaxitk=kvaMVx7EIROYGBtiHtuOuA&hsa_cr_id=9596171540801&ref_=sb_s_sparkle')\n\n\nconst mnData = scrapeData('https://www.dph.illinois.gov/covid19/covid19-statistics', 'https://www.health.state.mn.us/diseases/coronavirus/situation.html'); // export default mnData;","map":{"version":3,"sources":["/Users/annamaxam/repos/covid19-graph/src/scrapers.js"],"names":["puppeteer","require","express","app","get","req","res","console","log","browser","launch","page","newPage","goto","query","url","mnCasesChartEl","$x","mnCasesChartTxt","getProperty","mnCasesChart","jsonValue","writeHead","data","length","send","splitCases","close","listen","scrapeData","ilUrl","mnUrl","buildDate","today","Date","String","getMonth","getDate","getFullYear","name","IL","MN","logCases","cases","scrapeIlData","ilCasesEl","ilCasesTxt","ilCases","split","parsed","slice","forEach","getDayData","dayString","index","arr","day","replace","MN_new","Number","MN_total","scrapeMnData","mnCasesEl","mnCasesTxt","mnCases","end","mnData"],"mappings":"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","sourcesContent":["const puppeteer = require('puppeteer');\nconst express = require('express');\n\nconst app = express();\n\napp.get('/data', async (req, res) => { \n    // scrapeMnData(req.query.url, res)\n    console.log(\"made it!\")\n\n    const browser = await puppeteer.launch();\n    const page = await browser.newPage();\n    await page.goto(req.query.url);\n    \n    console.log(\"went to page\")\n\n    // const [mnCasesEl] = await page.$x('//*[@id=\"body\"]/ul[2]/li/text()')\n    // const mnCasesTxt = await mnCasesEl.getProperty('textContent');\n    // const mnCases = await mnCasesTxt.jsonValue();\n\n    const [mnCasesChartEl] = await page.$x('//*[@id=\"body\"]/img[1]');\n    const mnCasesChartTxt = await mnCasesChartEl.getProperty('alt');\n    const mnCasesChart = await mnCasesChartTxt.jsonValue();\n\n    // logCases(mnCases);\n\n    res.writeHead(200, {\n        'Content-Type': 'application/json',\n        'Content-Length': data.length\n    });\n    res.send(splitCases(mnCasesChart));\n    \n    await browser.close();\n\n\n\n})\n\napp.listen(4000);\n\n\nasync function scrapeData(ilUrl, mnUrl) {\n    // scrapeIlData(ilUrl)\n    // return scrapeMnData(mnUrl);\n}\n\nfunction buildDate() {\n    let today = new Date();\n    return (String(today.getMonth() + 1) + '-' + String(today.getDate()) + '-' + String(today.getFullYear()));\n\n}\n\nconst data = [\n    {\n        name: 'Page A', IL: 4000, MN: 2400\n    },\n    {\n        name: 'Page B', IL: 3000, MN: 1398\n    },\n    {\n        name: 'Page C', IL: 2000, MN: 11800\n    },\n    {\n        name: 'Page D', IL: 2780, MN: 3908\n    },\n    {\n        name: 'Page E', IL: 1890, MN: 4800\n    },\n    {\n        name: 'Page F', IL: 2390, MN: 3800\n    },\n    {\n        name: 'Page G', IL: 3490, MN: 4300\n    },\n];\n\n\nfunction logCases(cases) {\n    \n    console.log(buildDate() + ': ' + cases);\n}\n\n\n\nasync function scrapeIlData(url) {\n    const browser = await puppeteer.launch();\n    const page = await browser.newPage();\n    await page.goto(url);\n\n    \n    const [ilCasesEl] = await page.$x('//*[@id=\"covid19positive\"]');\n    const ilCasesTxt = await ilCasesEl.getProperty('textContent');\n    const ilCases = await ilCasesTxt.jsonValue();\n\n    logCases(ilCases);\n\n    browser.close();\n\n}\n\nfunction splitCases(cases) {\n    const data = cases.split(\"\\n\");\n    const parsed = data.slice(1, data.length-1);\n    parsed.forEach(getDayData);\n    return parsed; \n}\n\nfunction getDayData(dayString, index, arr) {\n    const day = dayString.replace(\"\\t\", \" \").split(\", \");\n    arr[index] = { name: day[0], MN_new: Number(day[1]), MN_total: Number(day[2]) }\n    // dayString = dayString.replace(\"\\t\", \" \").split(\", \");\n    // console.log(dayString);\n    // return a;\n}\n\nasync function scrapeMnData(url, res) {\n    const browser = await puppeteer.launch();\n    const page = await browser.newPage();\n    await page.goto(url);\n\n    const [mnCasesEl] = await page.$x('//*[@id=\"body\"]/ul[2]/li/text()')\n    const mnCasesTxt = await mnCasesEl.getProperty('textContent');\n    const mnCases = await mnCasesTxt.jsonValue();\n\n    const [mnCasesChartEl] = await page.$x('//*[@id=\"body\"]/img[1]');\n    const mnCasesChartTxt = await mnCasesChartEl.getProperty('alt');\n    const mnCasesChart = await mnCasesChartTxt.jsonValue();\n\n    logCases(mnCases);\n\n    res.writeHead(200, {\n        'Content-Type': 'application/json',\n        'Content-Length': data.length\n    });\n    res.end(splitCases(mnCasesChart));\n    \n    await browser.close();\n\n    // return splitCases(mnCasesChart);\n\n}\n\n\n\n\n// scrapeData('https://covid19stats.live/coronavirus/statistics/usa')\n\n// scrapeData('https://www.amazon.com/Black-Swan-Improbable-Nicholas-Takeaways/dp/B01AIKQ5LY/ref=sr_1_8?dchild=1&keywords=The+Black+Swan&qid=1586028302&s=books&sr=1-8')\n\n// scrapeData('https://www.amazon.com/Original-Sliding-C-Slide-Privacy-Chromebooks/dp/B00HPC66U4/ref=redir_mobile_desktop?ie=UTF8&aaxitk=kvaMVx7EIROYGBtiHtuOuA&hsa_cr_id=9596171540801&ref_=sb_s_sparkle')\n\nconst mnData = scrapeData('https://www.dph.illinois.gov/covid19/covid19-statistics', 'https://www.health.state.mn.us/diseases/coronavirus/situation.html')\n\n// export default mnData;\n\n\n"]},"metadata":{},"sourceType":"module"}